services:
  dolphindb:
    image: dolphindb/dolphindb:v3.00.5
    container_name: quant_dolphindb
    ports:
      - "8848:8848"
    volumes:
      - /Users/lisheng/Code/application/dolphin/data:/data/ddb/server/data
    environment:
      TZ: Asia/Shanghai
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:8848/ || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 5
      start_period: 30s
    networks:
      - quant_network

  prefect-server:
    image: prefecthq/prefect:3-latest
    container_name: quant_prefect
    command: prefect server start 
    ports:
      - "4200:4200"
    environment:
      PREFECT_SERVER_API_HOST: "0.0.0.0"
      PREFECT_UI_API_URL: "http://localhost:4200/api"
      PREFECT_API_DATABASE_CONNECTION_URL: "sqlite+aiosqlite:////data/prefect.db"
      TZ: Asia/Shanghai
    volumes:
      - /Users/lisheng/Code/application/prefect:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "python -c 'import httpx; httpx.get(\"http://localhost:4200/api/health\")' || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 5
      start_period: 20s
    networks:
      - quant_network

networks:
  quant_network:
    driver: bridge

